language: go

go:
  - 1.11.6
  - 1.12.1
  - tip
  
env:
  - MAKE_TASK=test
  - MAKE_TASK=vet
  - MAKE_TASK=fmt

matrix:
  fast_finish: true
  allow_failures:
  - go: tip
  exclude: # only lint on the mainline go version
  - go: 1.12.1
    env: MAKE_TASK=lintall

sudo: true

before_install:
  - sudo add-apt-repository ppa:masterminds/glide -y && sudo apt-get update -q
  - sudo apt-get install glide -y
  - curl -L  https://github.com/coreos/etcd/releases/download/v3.0.15/etcd-v3.0.15-linux-amd64.tar.gz -o etcd-v3.0.15-linux-amd64.tar.gz
  - tar xzvf etcd-v3.0.15-linux-amd64.tar.gz
  - ./etcd-v3.0.15-linux-amd64/etcd &

before_script:
  - make deps

script:
  - make ${MAKE_TASK}

after_success:
    - 'if [ "$TRAVIS_PULL_REQUEST" = "false" && "$MAKE_TASK" = "test" ]; then goveralls -coverprofile=coverage.out -service=travis-ci -repotoken $COVERALLS_TOKEN; fi'
